<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <artifactId>nd4j-shade</artifactId>
        <groupId>org.nd4j</groupId>
        <version>0.6.1-SNAPSHOT</version>
    </parent>
    <modelVersion>4.0.0</modelVersion>

    <artifactId>dropwizard</artifactId>


    <build>
        <plugins>
            <!--
            Use Maven Shade plugin to add a shaded version of Dropwizard and its major dependencies, that can be imported by
            including this module (org.nd4j.dropwizard) as a dependency.
            The major dependenices (Jackson, Jersey, Jetty, Glassfish) are also shaded here, in addition to dropwizard
            These dependenices are renamed and prefixed by the package org.nd4j.shade
            -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-shade-plugin</artifactId>
                <version>${maven-shade-plugin.version}</version>
                <executions>
                    <execution>
                        <phase>package</phase>
                        <goals>
                            <goal>shade</goal>
                        </goals>
                        <configuration>
                            <transformers>
                                <transformer
                                        implementation="org.apache.maven.plugins.shade.resource.AppendingTransformer">
                                    <resource>reference.conf</resource>
                                </transformer>
                                <transformer
                                        implementation="org.apache.maven.plugins.shade.resource.ServicesResourceTransformer"/>
                                <transformer
                                        implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer">
                                </transformer>
                            </transformers>
                        </configuration>
                    </execution>
                </executions>

                <configuration>
                    <shadedArtifactAttached>false</shadedArtifactAttached>
                    <createDependencyReducedPom>false</createDependencyReducedPom>
                    <promoteTransitiveDependencies>true</promoteTransitiveDependencies>

                    <artifactSet>
                        <includes>
                            <include>io.dropwizard:*</include>
                            <include>io.dropwizard.*:*</include>
                            <!-- Dropwizard key dependencies: glassfish, jersey, jetty, jackson -->
                            <include>org.glassfish</include>
                            <include>com.sun.jersey:*</include>
                            <include>com.sun.jersey.*:*</include>
                            <include>org.eclipse.jetty:*</include>
                            <include>org.eclipse.jetty.*:*</include>
                            <include>com.fasterxml.jackson:*</include>
                            <include>com.fasterxml.jackson.*:*</include>
                            <include>javax.*:*</include>
                            <include>com.google.*:*</include>
                            <include>com.google:*</include>
                        </includes>
                    </artifactSet>

                    <relocations>
                        <!-- Dropwizard and its dependencies: glassfish, jersey, jetty (org.eclipse) -->
                        <relocation>
                            <pattern>io.dropwizard</pattern>
                            <shadedPattern>org.nd4j.shade.dropwizard</shadedPattern>
                        </relocation>

                        <!-- Glassfish -->
                        <relocation>
                            <pattern>org.glassfish</pattern>
                            <shadedPattern>org.nd4j.shade.glassfish</shadedPattern>
                        </relocation>

                        <!-- Jersey -->
                        <relocation>
                            <pattern>com.sun.jersey</pattern>
                            <shadedPattern>org.nd4j.shade.jersey</shadedPattern>
                        </relocation>

                        <!-- Jetty (org.eclipse.jetty) -->
                        <relocation>
                            <pattern>org.eclipse.jetty</pattern>
                            <shadedPattern>org.nd4j.shade.jetty</shadedPattern>
                        </relocation>

                        <!-- Jackson dependencies. We are shading Jackson for dropwizard separately to other ND4J dependencies to allow separate versions -->
                        <relocation>
                            <pattern>com.fasterxml.jackson</pattern>
                            <shadedPattern>org.nd4j.shade.dwjackson</shadedPattern>
                        </relocation>

                        <!-- Guava dependencies -->
                        <relocation>
                            <pattern>com.google</pattern>
                            <shadedPattern>org.nd4j.shade.google</shadedPattern>
                        </relocation>

                        <!-- JavaX etc -->
                        <relocation>
                            <pattern>javax</pattern>
                            <shadedPattern>org.nd4j.shade.javax</shadedPattern>
                        </relocation>
                    </relocations>
                </configuration>
            </plugin>
        </plugins>
    </build>

    <!--
    Regarding dependencies here: Note the <optional>true</optional> configuration.
    This allows 2 things:
    (a) These dependencies to be shaded - i.e., are included in the org.nd4j:dropwizard JARs for install/release etc
    (b) The original dependencies will not appear as a transitive dependency

    Other approaches, such as using scopes (provided, runtime, or import) seem to remove both shaded AND transitive dependencies,
    or keep both. In the case of runtime scope, the original dependencies still show up as a transitive dependency (but
    are not provided), which
    -->
    <dependencies>
        <dependency>
            <groupId>io.dropwizard</groupId>
            <artifactId>dropwizard-core</artifactId>
            <version>${dropwizard.version}</version>
            <optional>true</optional>
        </dependency>

        <dependency>
            <groupId>io.dropwizard</groupId>
            <artifactId>dropwizard-assets</artifactId>
            <version>${dropwizard.version}</version>
            <optional>true</optional>
        </dependency>

        <dependency>
            <groupId>io.dropwizard</groupId>
            <artifactId>dropwizard-client</artifactId>
            <version>${dropwizard.version}</version>
            <optional>true</optional>
        </dependency>

        <dependency>
            <groupId>io.dropwizard</groupId>
            <artifactId>dropwizard-forms</artifactId>
            <version>${dropwizard.version}</version>
            <optional>true</optional>
        </dependency>

        <dependency>
            <groupId>io.dropwizard</groupId>
            <artifactId>dropwizard-views-mustache</artifactId>
            <version>${dropwizard.version}</version>
            <optional>true</optional>
        </dependency>

        <dependency>
            <groupId>io.dropwizard</groupId>
            <artifactId>dropwizard-views-freemarker</artifactId>
            <version>${dropwizard.version}</version>
            <optional>true</optional>
        </dependency>

        <!--<dependency>-->
            <!--<groupId>javax.ws.rs</groupId>-->
            <!--<artifactId>javax.ws.rs-api</artifactId>-->
            <!--<version>2.0.1</version>-->
        <!--</dependency>-->


    </dependencies>

</project>